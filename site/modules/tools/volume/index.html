
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A web application to explore the mouse Lipid Brain Atlas.">
      
      
        <meta name="author" content="Colas Droin">
      
      
        <link rel="canonical" href="https://lbae.epfl.ch/modules/tools/volume/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Volume - LBAE technical documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modules.tools.volume" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="LBAE technical documentation" class="md-header__button md-logo" aria-label="LBAE technical documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LBAE technical documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Volume
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ColasDroin/lbae" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="LBAE technical documentation" class="md-nav__button md-logo" aria-label="LBAE technical documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    LBAE technical documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ColasDroin/lbae" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Welcome page
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../main/" class="md-nav__link">
        main
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../app/" class="md-nav__link">
        app
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../index_py/" class="md-nav__link">
        index
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../atlas_labels/" class="md-nav__link">
        atlas_labels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../atlas/" class="md-nav__link">
        atlas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../figures/" class="md-nav__link">
        figures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../launch/" class="md-nav__link">
        launch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../maldi_data/" class="md-nav__link">
        maldi_data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../scRNAseq/" class="md-nav__link">
        scRNAseq
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/" class="md-nav__link">
        storage
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_8" type="checkbox" id="__nav_5_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5_8">
          Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tools" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_8">
          <span class="md-nav__icon md-icon"></span>
          Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../atlas/" class="md-nav__link">
        Atlas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../image/" class="md-nav__link">
        Image
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lookup_tables/" class="md-nav__link">
        Lookup tables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../maldi_conversion/" class="md-nav__link">
        Maldi conversion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc/" class="md-nav__link">
        Misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spectra/" class="md-nav__link">
        Spectra
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Volume
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Volume
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume" class="md-nav__link">
    modules.tools.volume
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.crop_array" class="md-nav__link">
    crop_array()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.fill_array_borders" class="md-nav__link">
    fill_array_borders()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.fill_array_interpolation" class="md-nav__link">
    fill_array_interpolation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.fill_array_slices" class="md-nav__link">
    fill_array_slices()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.filter_voxels" class="md-nav__link">
    filter_voxels()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Pages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pages" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Pages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/home/" class="md-nav__link">
        home
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/sidebar/" class="md-nav__link">
        sidebar
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/load_slice/" class="md-nav__link">
        load_slice
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/lipid_selection/" class="md-nav__link">
        lipid_selection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/region_analysis/" class="md-nav__link">
        region_analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/threeD_exploration/" class="md-nav__link">
        threeD_exploration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/scRNAseq/" class="md-nav__link">
        scRNAseq
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume" class="md-nav__link">
    modules.tools.volume
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.crop_array" class="md-nav__link">
    crop_array()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.fill_array_borders" class="md-nav__link">
    fill_array_borders()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.fill_array_interpolation" class="md-nav__link">
    fill_array_interpolation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.fill_array_slices" class="md-nav__link">
    fill_array_slices()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules.tools.volume.filter_voxels" class="md-nav__link">
    filter_voxels()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/ColasDroin/lbae/edit/master/docs/modules/tools/volume.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>Volume</h1>

<div class="doc doc-object doc-module">


<a id="modules.tools.volume"></a>
  <div class="doc doc-contents first">
  
      <p>In this module, functions used to handle 3D graphing (e.g. voxel filtering, interpolations, etc) 
are defined.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="modules.tools.volume.crop_array" class="doc doc-heading">
<code class="highlight language-python"><span class="n">crop_array</span><span class="p">(</span><span class="n">array_annotation</span><span class="p">,</span> <span class="n">list_id_regions</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Given an array of annotations containing regions as ids, and a list of ids, this functions
crops the parts of the array that do not contain the regions inside of the list.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>array_annotation</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A 3D numpy array containing the annotations of the brain as
integers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>list_id_regions</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A flat array of integers containing the ids of the regions to
keep.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>int, int, int, int, int, int</code>
          </td>
          <td><p>The min and max indices to keep for each dimension.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>modules/tools/volume.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">crop_array</span><span class="p">(</span><span class="n">array_annotation</span><span class="p">,</span> <span class="n">list_id_regions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given an array of annotations containing regions as ids, and a list of ids, this functions</span>
<span class="sd">    crops the parts of the array that do not contain the regions inside of the list.</span>

<span class="sd">    Args:</span>
<span class="sd">        array_annotation (np.ndarray): A 3D numpy array containing the annotations of the brain as</span>
<span class="sd">            integers.</span>
<span class="sd">        list_id_regions (np.ndarray): A flat array of integers containing the ids of the regions to</span>
<span class="sd">            keep.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (int, int, int, int, int, int): The min and max indices to keep for each dimension.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define min and max as image dimensions initially</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Crop unfilled parts to save space</span>
    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">list_id_regions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">array_annotation</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]:</span>
                <span class="n">x_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">list_id_regions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">array_annotation</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]:</span>
                <span class="n">x_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">list_id_regions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">array_annotation</span><span class="p">[:,</span> <span class="n">y</span><span class="p">,</span> <span class="p">:]:</span>
                <span class="n">y_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y_min</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">list_id_regions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">array_annotation</span><span class="p">[:,</span> <span class="n">y</span><span class="p">,</span> <span class="p">:]:</span>
                <span class="n">y_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">list_id_regions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">array_annotation</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z</span><span class="p">]:</span>
                <span class="n">z_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z_min</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">list_id_regions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">id_structure</span> <span class="ow">in</span> <span class="n">array_annotation</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z</span><span class="p">]:</span>
                <span class="n">z_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z_max</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="c1"># If the cropping went properly, return the extrema indices, else return None</span>
    <span class="k">if</span> <span class="n">x_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="modules.tools.volume.fill_array_borders" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fill_array_borders</span><span class="p">(</span><span class="n">array_annotation</span><span class="p">,</span> <span class="n">differentiate_borders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color_near_borders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keep_structure_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">annot_outside</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">annot_border</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">annot_inside</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">annot_near_border</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">decrease_dimensionality_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes the Allen Brain atlas array of annotation and returns an array
representing the borders of the atlas, to be used later for the volume plot. Values in the array
are as follows by default:
-2 is outside brain or selected structures
-0.1 is border if differentiate_borders is True
-0.01 is inside brain/structure
0.2 is near border if color_near_borders is True
NB: the -0.01 values get changed after assignment to lipid expression, later on in
fill_array_interpolation.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>array_annotation</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Three-dimensional array of annotation coming from the Allen
Brain Atlas.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>differentiate_borders</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, represent the brain border with a different
value. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>color_near_borders</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the region surrounding the brain border is
also filled. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>keep_structure_id</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Array containing the id of the brain regions whose
border must be annotated. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>annot_outside</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Value to be used for the areas outside of the brain.
Defaults to -2.</p></td>
          <td>
                <code>-2</code>
          </td>
        </tr>
        <tr>
          <td><code>annot_border</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Value to be used for the border of the brain. Defaults
to -0.1.</p></td>
          <td>
                <code>-0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>annot_inside</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Value to be used for the inside of the brain. Defaults
to -0.01.</p></td>
          <td>
                <code>-0.01</code>
          </td>
        </tr>
        <tr>
          <td><code>annot_near_border</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Value to be used for the color of the area near the
border of the brain. Defaults to 0.2.</p></td>
          <td>
                <code>0.2</code>
          </td>
        </tr>
        <tr>
          <td><code>decrease_dimensionality_factor</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Useless parameter, kept for ensuring that
shelving is done properly, as array_annotation corresponds to a given
decrease_dimensionality_factor. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A numpy array representing the borders of the atlas.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>modules/tools/volume.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">fill_array_borders</span><span class="p">(</span>
    <span class="n">array_annotation</span><span class="p">,</span>
    <span class="n">differentiate_borders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">color_near_borders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">keep_structure_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">annot_outside</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">annot_border</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">annot_inside</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">annot_near_border</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">decrease_dimensionality_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function takes the Allen Brain atlas array of annotation and returns an array</span>
<span class="sd">    representing the borders of the atlas, to be used later for the volume plot. Values in the array</span>
<span class="sd">    are as follows by default:</span>
<span class="sd">    -2 is outside brain or selected structures</span>
<span class="sd">    -0.1 is border if differentiate_borders is True</span>
<span class="sd">    -0.01 is inside brain/structure</span>
<span class="sd">    0.2 is near border if color_near_borders is True</span>
<span class="sd">    NB: the -0.01 values get changed after assignment to lipid expression, later on in</span>
<span class="sd">    fill_array_interpolation.</span>

<span class="sd">    Args:</span>
<span class="sd">        array_annotation (np.ndarray): Three-dimensional array of annotation coming from the Allen</span>
<span class="sd">            Brain Atlas.</span>
<span class="sd">        differentiate_borders (bool, optional): If True, represent the brain border with a different</span>
<span class="sd">            value. Defaults to False.</span>
<span class="sd">        color_near_borders (bool, optional): If True, the region surrounding the brain border is</span>
<span class="sd">            also filled. Defaults to False.</span>
<span class="sd">        keep_structure_id (np.ndarray, optional): Array containing the id of the brain regions whose</span>
<span class="sd">            border must be annotated. Defaults to None.</span>
<span class="sd">        annot_outside (float, optional): Value to be used for the areas outside of the brain.</span>
<span class="sd">            Defaults to -2.</span>
<span class="sd">        annot_border (float, optional): Value to be used for the border of the brain. Defaults</span>
<span class="sd">            to -0.1.</span>
<span class="sd">        annot_inside (float, optional): Value to be used for the inside of the brain. Defaults</span>
<span class="sd">            to -0.01.</span>
<span class="sd">        annot_near_border (float, optional): Value to be used for the color of the area near the</span>
<span class="sd">            border of the brain. Defaults to 0.2.</span>
<span class="sd">        decrease_dimensionality_factor (int, optional): Useless parameter, kept for ensuring that</span>
<span class="sd">            shelving is done properly, as array_annotation corresponds to a given</span>
<span class="sd">            decrease_dimensionality_factor. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (np.ndarray): A numpy array representing the borders of the atlas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">array_atlas_borders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">array_annotation</span><span class="p">,</span> <span class="n">annot_outside</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">array_annotation</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">keep_structure_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">array_annotation</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keep_structure_id</span><span class="p">:</span>
                            <span class="k">continue</span>

                    <span class="c1"># If we want to plot the brain border with a different shade</span>
                    <span class="k">if</span> <span class="n">differentiate_borders</span><span class="p">:</span>
                        <span class="c1"># check if border in a cube of size 2</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">for</span> <span class="n">xt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">yt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">zt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
                                    <span class="c1"># two cases in which there&#39;s a border around, depending if</span>
                                    <span class="c1"># keep_structure_id is defined</span>
                                    <span class="k">if</span> <span class="n">keep_structure_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="n">array_annotation</span><span class="p">[</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="n">array_annotation</span><span class="p">[</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keep_structure_id</span><span class="p">:</span>
                                            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                            <span class="n">array_atlas_borders</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">annot_border</span>
                        <span class="c1"># inside the brain/structure but not a border</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">array_atlas_borders</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">annot_inside</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">array_atlas_borders</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">annot_inside</span>

    <span class="c1"># Also color the region surrounding the border</span>
    <span class="k">if</span> <span class="n">color_near_borders</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array_atlas_borders</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">xt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">yt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">zt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
                                    <span class="c1"># not on the border</span>
                                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array_atlas_borders</span><span class="p">[</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">:</span>
                                        <span class="n">array_atlas_borders</span><span class="p">[</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">]</span> <span class="o">=</span> <span class="n">annot_near_border</span>

    <span class="k">return</span> <span class="n">array_atlas_borders</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="modules.tools.volume.fill_array_interpolation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fill_array_interpolation</span><span class="p">(</span><span class="n">array_annotation</span><span class="p">,</span> <span class="n">array_slices</span><span class="p">,</span> <span class="n">divider_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">annot_inside</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">limit_value_inside</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">structure_guided</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function is used to fill the empty space (unassigned voxels) between the slices with
interpolated values.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>array_annotation</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Three-dimensional array of annotation coming from the Allen
Brain Atlas.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_slices</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Three-dimensional array containing the lipid intensity values
from the MALDI experiments (with many unassigned voxels).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>divider_radius</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Divides the radius of the region used for interpolation
(the bigger, the lower the number of voxels used). Defaults to 5.</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>annot_inside</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Value used to denotate the inside of the brain. Defaults
to -0.01.</p></td>
          <td>
                <code>-0.01</code>
          </td>
        </tr>
        <tr>
          <td><code>limit_value_inside</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Alternative to annot_inside. Values above
limit_value_inside are considered inside the brain. Defaults to -2.</p></td>
          <td>
                <code>-2</code>
          </td>
        </tr>
        <tr>
          <td><code>structure_guided</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the interpolation is done using the annotated
structures. If False, the interpolation is done blindly.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A three-dimensional array containing the interpolated lipid intensity values.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>modules/tools/volume.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">fill_array_interpolation</span><span class="p">(</span>
    <span class="n">array_annotation</span><span class="p">,</span>
    <span class="n">array_slices</span><span class="p">,</span>
    <span class="n">divider_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">annot_inside</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">limit_value_inside</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">structure_guided</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function is used to fill the empty space (unassigned voxels) between the slices with</span>
<span class="sd">    interpolated values.</span>

<span class="sd">    Args:</span>
<span class="sd">        array_annotation (np.ndarray): Three-dimensional array of annotation coming from the Allen</span>
<span class="sd">            Brain Atlas.</span>
<span class="sd">        array_slices (np.ndarray): Three-dimensional array containing the lipid intensity values</span>
<span class="sd">            from the MALDI experiments (with many unassigned voxels).</span>
<span class="sd">        divider_radius (int, optional): Divides the radius of the region used for interpolation</span>
<span class="sd">            (the bigger, the lower the number of voxels used). Defaults to 5.</span>
<span class="sd">        annot_inside (float, optional): Value used to denotate the inside of the brain. Defaults</span>
<span class="sd">            to -0.01.</span>
<span class="sd">        limit_value_inside (float, optional): Alternative to annot_inside. Values above</span>
<span class="sd">            limit_value_inside are considered inside the brain. Defaults to -2.</span>
<span class="sd">        structure_guided (bool, optional): If True, the interpolation is done using the annotated</span>
<span class="sd">            structures. If False, the interpolation is done blindly.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (np.ndarray): A three-dimensional array containing the interpolated lipid intensity values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">array_interpolated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">array_slices</span><span class="p">)</span>

    <span class="c1"># Start from 8 as we don&#39;t have data before and the structure disposition makes it look</span>
    <span class="c1"># like a bug with the interpolation</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="c1"># If we are in a unfilled region of the brain or just inside the brain</span>
                <span class="n">condition_fulfilled</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">array_slices</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">condition_fulfilled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">limit_value_inside</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">condition_fulfilled</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">array_annotation</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">limit_value_inside</span><span class="p">:</span>
                        <span class="n">condition_fulfilled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array_slices</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">-</span> <span class="n">annot_inside</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">4</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">condition_fulfilled</span><span class="p">:</span>
                    <span class="n">condition_fulfilled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">condition_fulfilled</span><span class="p">:</span>
                    <span class="c1"># Check all datapoints in the same structure, and do a distance-weighted average</span>
                    <span class="n">value_voxel</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">sum_weights</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">size_radius</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">divider_radius</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">xt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                        <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">size_radius</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span> <span class="o">+</span> <span class="n">size_radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="k">for</span> <span class="n">yt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                            <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">size_radius</span><span class="p">),</span>
                            <span class="nb">min</span><span class="p">(</span><span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span> <span class="o">+</span> <span class="n">size_radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="p">):</span>
                            <span class="k">for</span> <span class="n">zt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span> <span class="o">-</span> <span class="n">size_radius</span><span class="p">),</span>
                                <span class="nb">min</span><span class="p">(</span><span class="n">array_annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">z</span> <span class="o">+</span> <span class="n">size_radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="p">):</span>
                                <span class="c1"># If we are inside of the shere of radius size_radius</span>
                                <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">xt</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">yt</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">zt</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                                    <span class="o">&lt;=</span> <span class="n">size_radius</span>
                                <span class="p">):</span>
                                    <span class="c1"># The voxel has data</span>
                                    <span class="k">if</span> <span class="n">array_slices</span><span class="p">[</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="c1"># The structure is identical</span>
                                        <span class="k">if</span> <span class="p">(</span>
                                            <span class="n">structure_guided</span>
                                            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                                                <span class="n">array_annotation</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
                                                <span class="o">-</span> <span class="n">array_annotation</span><span class="p">[</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">]</span>
                                            <span class="p">)</span>
                                            <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">4</span>
                                        <span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">structure_guided</span><span class="p">:</span>
                                            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                                                <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xt</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">yt</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">zt</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                                            <span class="p">)</span>
                                            <span class="n">value_voxel</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">array_slices</span><span class="p">[</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">zt</span><span class="p">]</span>
                                            <span class="n">sum_weights</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sum_weights</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">pass</span>
                        <span class="c1"># print(&quot;No other voxel found for structure &quot;, array_annotation[x, y, z])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># print(&#39;Voxel found for structure&#39;, array_annotation[x, y, z])</span>
                        <span class="n">value_voxel</span> <span class="o">=</span> <span class="n">value_voxel</span> <span class="o">/</span> <span class="n">sum_weights</span>
                        <span class="n">array_interpolated</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_voxel</span>

    <span class="k">return</span> <span class="n">array_interpolated</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="modules.tools.volume.fill_array_slices" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fill_array_slices</span><span class="p">(</span><span class="n">array_x</span><span class="p">,</span> <span class="n">array_y</span><span class="p">,</span> <span class="n">array_z</span><span class="p">,</span> <span class="n">array_c</span><span class="p">,</span> <span class="n">array_slices</span><span class="p">,</span> <span class="n">array_for_avg</span><span class="p">,</span> <span class="n">limit_value_inside</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes the arrays of expression in the slices and fills the 3D array of
expression with them, inside of the regions annotated in the provided array_slices (which is
initially a simple copy of array_atlas_borders).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>array_x</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A flat array of x coordinates for the 3D graphing.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_y</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A flat array of y coordinates for the 3D graphing.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_z</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A flat array of z coordinates for the 3D graphing.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_c</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A flat array of expression values (float) for the 3D graphing.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_slices</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Initially, a 3D numpy array representing the borders of the atlas.
It is then filled with lipid expression values (from array_c) in the slices.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_for_avg</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A 3D numpy array used for keeping count of the number of times
a cell has been assigned, for averaging the expression values later on.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>limit_value_inside</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The value above which the array must be filled, i.e.
corresponds to an annotated region of the brain. Defaults to -0.05.</p></td>
          <td>
                <code>-0.05</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A 3D numpy array representing the expression of the lipids preliminarily stored
in array_c, in the regions preliminarily annotated in array_slices.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>modules/tools/volume.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">fill_array_slices</span><span class="p">(</span>
    <span class="n">array_x</span><span class="p">,</span>
    <span class="n">array_y</span><span class="p">,</span>
    <span class="n">array_z</span><span class="p">,</span>
    <span class="n">array_c</span><span class="p">,</span>
    <span class="n">array_slices</span><span class="p">,</span>
    <span class="n">array_for_avg</span><span class="p">,</span>
    <span class="n">limit_value_inside</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function takes the arrays of expression in the slices and fills the 3D array of</span>
<span class="sd">    expression with them, inside of the regions annotated in the provided array_slices (which is</span>
<span class="sd">    initially a simple copy of array_atlas_borders).</span>

<span class="sd">    Args:</span>
<span class="sd">        array_x (np.ndarray): A flat array of x coordinates for the 3D graphing.</span>
<span class="sd">        array_y (np.ndarray): A flat array of y coordinates for the 3D graphing.</span>
<span class="sd">        array_z (np.ndarray): A flat array of z coordinates for the 3D graphing.</span>
<span class="sd">        array_c (np.ndarray): A flat array of expression values (float) for the 3D graphing.</span>
<span class="sd">        array_slices (np.ndarray): Initially, a 3D numpy array representing the borders of the atlas.</span>
<span class="sd">            It is then filled with lipid expression values (from array_c) in the slices.</span>
<span class="sd">        array_for_avg (np.ndarray): A 3D numpy array used for keeping count of the number of times</span>
<span class="sd">            a cell has been assigned, for averaging the expression values later on.</span>
<span class="sd">        limit_value_inside (float, optional): The value above which the array must be filled, i.e.</span>
<span class="sd">            corresponds to an annotated region of the brain. Defaults to -0.05.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (np.ndarray): A 3D numpy array representing the expression of the lipids preliminarily stored</span>
<span class="sd">            in array_c, in the regions preliminarily annotated in array_slices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">array_x</span><span class="p">,</span> <span class="n">array_y</span><span class="p">,</span> <span class="n">array_z</span><span class="p">,</span> <span class="n">array_c</span><span class="p">):</span>
        <span class="c1"># ! Coordinates need to be switched</span>
        <span class="n">x_scaled</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="n">y_scaled</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
        <span class="n">z_scaled</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="c1"># If inside the brain</span>
        <span class="k">if</span> <span class="n">array_slices</span><span class="p">[</span><span class="n">x_scaled</span><span class="p">,</span> <span class="n">y_scaled</span><span class="p">,</span> <span class="n">z_scaled</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">limit_value_inside</span><span class="p">:</span>
            <span class="c1"># If inside the brain and not assigned before</span>
            <span class="k">if</span> <span class="n">array_slices</span><span class="p">[</span><span class="n">x_scaled</span><span class="p">,</span> <span class="n">y_scaled</span><span class="p">,</span> <span class="n">z_scaled</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">array_slices</span><span class="p">[</span><span class="n">x_scaled</span><span class="p">,</span> <span class="n">y_scaled</span><span class="p">,</span> <span class="n">z_scaled</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="c1"># Inside the brain but already assigned, in which case average</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">array_slices</span><span class="p">[</span><span class="n">x_scaled</span><span class="p">,</span> <span class="n">y_scaled</span><span class="p">,</span> <span class="n">z_scaled</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">array_for_avg</span><span class="p">[</span><span class="n">x_scaled</span><span class="p">,</span> <span class="n">y_scaled</span><span class="p">,</span> <span class="n">z_scaled</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">array_slices</span> <span class="o">=</span> <span class="n">array_slices</span> <span class="o">/</span> <span class="n">array_for_avg</span>
    <span class="k">return</span> <span class="n">array_slices</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="modules.tools.volume.filter_voxels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_voxels</span><span class="p">(</span><span class="n">array_data_stripped</span><span class="p">,</span> <span class="n">coordinates_stripped</span><span class="p">,</span> <span class="n">array_annotations</span><span class="p">,</span> <span class="n">percentile</span><span class="p">,</span> <span class="n">array_x</span><span class="p">,</span> <span class="n">array_y</span><span class="p">,</span> <span class="n">array_z</span><span class="p">,</span> <span class="n">array_c</span><span class="p">,</span> <span class="n">total_index</span><span class="p">,</span> <span class="n">reference_shape</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes a given array of coordinates 'coordinates_stripped' and checks if it
corresponds to a given annotation in the atlas. If so, the coordinates are added to the arrays
'array_x', 'array_y', 'array_z' to be used for the 3D graphing. Else, it's filtered out.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>array_data_stripped</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A 2-dimensional array of voxel intensity for the current
slice, stripped of zero values.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>coordinates_stripped</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A 2-dimensional array of voxel coordinates for the
current slice, stripped of zero values.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_annotations</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The 3-dimensional array of annotation coming from the Allen
Brain Atlas.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>percentile</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The value above which the voxels are considered for the graphing.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_x</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A flat array of x coordinates for the 3D graphing.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_y</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A flat array of y coordinates for the 3D graphing.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_z</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A flat array of z coordinates for the 3D graphing.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>array_c</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>A flat array of color (expression) values (float) for the 3D graphing.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>total_index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>An integer used to keep track of the array indexing outside of this
function.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference_shape</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Array containing the reference atlas shape.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>resolution</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Integer representing the resolution of the atlas.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, int</code>
          </td>
          <td><p>The filled arrays of coordinates or
color for the current slice, and the updated total_index.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>modules/tools/volume.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">filter_voxels</span><span class="p">(</span>
    <span class="n">array_data_stripped</span><span class="p">,</span>
    <span class="n">coordinates_stripped</span><span class="p">,</span>
    <span class="n">array_annotations</span><span class="p">,</span>
    <span class="n">percentile</span><span class="p">,</span>
    <span class="n">array_x</span><span class="p">,</span>
    <span class="n">array_y</span><span class="p">,</span>
    <span class="n">array_z</span><span class="p">,</span>
    <span class="n">array_c</span><span class="p">,</span>
    <span class="n">total_index</span><span class="p">,</span>
    <span class="n">reference_shape</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function takes a given array of coordinates &#39;coordinates_stripped&#39; and checks if it</span>
<span class="sd">    corresponds to a given annotation in the atlas. If so, the coordinates are added to the arrays</span>
<span class="sd">    &#39;array_x&#39;, &#39;array_y&#39;, &#39;array_z&#39; to be used for the 3D graphing. Else, it&#39;s filtered out.</span>

<span class="sd">    Args:</span>
<span class="sd">        array_data_stripped (np.ndarray): A 2-dimensional array of voxel intensity for the current</span>
<span class="sd">            slice, stripped of zero values.</span>
<span class="sd">        coordinates_stripped (np.ndarray): A 2-dimensional array of voxel coordinates for the</span>
<span class="sd">            current slice, stripped of zero values.</span>
<span class="sd">        array_annotations (np.ndarray): The 3-dimensional array of annotation coming from the Allen</span>
<span class="sd">            Brain Atlas.</span>
<span class="sd">        percentile (float): The value above which the voxels are considered for the graphing.</span>
<span class="sd">        array_x (np.ndarray): A flat array of x coordinates for the 3D graphing.</span>
<span class="sd">        array_y (np.ndarray): A flat array of y coordinates for the 3D graphing.</span>
<span class="sd">        array_z (np.ndarray): A flat array of z coordinates for the 3D graphing.</span>
<span class="sd">        array_c (np.ndarray): A flat array of color (expression) values (float) for the 3D graphing.</span>
<span class="sd">        total_index (int): An integer used to keep track of the array indexing outside of this</span>
<span class="sd">            function.</span>
<span class="sd">        reference_shape (np.ndarray): Array containing the reference atlas shape.</span>
<span class="sd">        resolution (int): Integer representing the resolution of the atlas.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (np.ndarray, np.ndarray, np.ndarray, np.ndarray, int): The filled arrays of coordinates or</span>
<span class="sd">            color for the current slice, and the updated total_index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Keep track of the array indexing even outside of this function</span>
    <span class="n">total_index_temp</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array_data_stripped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">x_atlas</span><span class="p">,</span> <span class="n">y_atlas</span><span class="p">,</span> <span class="n">z_atlas</span> <span class="o">=</span> <span class="n">coordinates_stripped</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="c1"># Filter out voxels that are not in the atlas</span>
        <span class="n">x_temp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x_atlas</span> <span class="o">*</span> <span class="mi">1000000</span> <span class="o">/</span> <span class="n">resolution</span><span class="p">))</span>
        <span class="n">y_temp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y_atlas</span> <span class="o">*</span> <span class="mi">1000000</span> <span class="o">/</span> <span class="n">resolution</span><span class="p">))</span>
        <span class="n">z_temp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">z_atlas</span> <span class="o">*</span> <span class="mi">1000000</span> <span class="o">/</span> <span class="n">resolution</span><span class="p">))</span>

        <span class="c1"># Voxels not even in the atlas array</span>
        <span class="k">if</span> <span class="n">x_temp</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x_temp</span> <span class="o">&gt;=</span> <span class="n">reference_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">y_temp</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y_temp</span> <span class="o">&gt;=</span> <span class="n">reference_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">z_temp</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">z_temp</span> <span class="o">&gt;=</span> <span class="n">reference_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">continue</span>

        <span class="c1"># Voxels in the atlas but which don&#39;t correspond to a structure</span>
        <span class="k">if</span> <span class="n">array_annotations</span><span class="p">[</span><span class="n">x_temp</span><span class="p">,</span> <span class="n">y_temp</span><span class="p">,</span> <span class="n">z_temp</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">array_data_stripped</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">percentile</span><span class="p">:</span>
            <span class="c1"># * careful, x,y,z are switched</span>
            <span class="n">array_x</span><span class="p">[</span><span class="n">total_index</span> <span class="o">+</span> <span class="n">total_index_temp</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_atlas</span>
            <span class="n">array_y</span><span class="p">[</span><span class="n">total_index</span> <span class="o">+</span> <span class="n">total_index_temp</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_atlas</span>
            <span class="n">array_z</span><span class="p">[</span><span class="n">total_index</span> <span class="o">+</span> <span class="n">total_index_temp</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_atlas</span>
            <span class="n">array_c</span><span class="p">[</span><span class="n">total_index</span> <span class="o">+</span> <span class="n">total_index_temp</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_data_stripped</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">total_index_temp</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">total_index</span> <span class="o">+=</span> <span class="n">total_index_temp</span>
    <span class="k">return</span> <span class="n">array_x</span><span class="p">,</span> <span class="n">array_y</span><span class="p">,</span> <span class="n">array_z</span><span class="p">,</span> <span class="n">array_c</span><span class="p">,</span> <span class="n">total_index</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../spectra/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Spectra" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Spectra
            </div>
          </div>
        </a>
      
      
        
        <a href="../../../pages/home/" class="md-footer__link md-footer__link--next" aria-label="Next: home" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              home
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections"], "search": "../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>